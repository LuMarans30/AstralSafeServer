<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <title>Quantum OTP</title>
</head>

<script>
    async function encrypt() {
        var plaintext = document.getElementById("msg").value;

        var json = "";

        var url = "https://astralsafeserver.onrender.com/api/encrypt";

        await $.post(url, { plaintext: plaintext },
            function (returnedData) {
                json = returnedData;
            });


        document.getElementById("result").value = json.encrypted;
    }

    function startVineBoom() {
        var vine = document.createElement("img");
        vine.setAttribute("id", "vine");
        vine.src = "https://media.tenor.com/PNmrRavjo40AAAAM/run.gif";
        vine.style.position = "absolute";
        vine.style.top = "0";
        vine.style.left = "0";
        vine.style.width = "100%";
        vine.style.height = "100%";
        vine.style.zIndex = "9999";

        document.body.appendChild(vine);
    }

    function stopVineBoom() {
        var vine = document.getElementById("vine");
        vine.remove();
    }

    async function decrypt() {

        var ciphertext = document.getElementById("msg").value;

        var url = "https://astralsafeserver.onrender.com/api/decrypt";

        var json = "";

        await $.post(url, { ciphertext: ciphertext },
            function (returnedData) {
                json = returnedData;
            });


        document.getElementById("result").value = json.plaintext;

        var badwords = "";

        var url1 = "https://raw.githubusercontent.com/napolux/paroleitaliane/master/paroleitaliane/lista_badwords.txt";

        const response = await fetch(url1);
        const data = await response.text();

        badwords = data.split("\n");

        badwords.forEach(element => {
            if (json.plaintext.includes(element)) {

                var url2 = "https://drive.google.com/uc?id=15JhAxQ_Qf6wsnzF7XOFGqDLOArw1wHSb&export=download";
                const audio = new Audio(url2);
                audio.play();
                startVineBoom();
                setTimeout(stopVineBoom, 2000);
            }
        });
    }

    function copyToClipboard() {
        var copyText = document.getElementById("result");
        navigator.clipboard.writeText(copyText.value);
    }

</script>

<style>
    #encrypt {
        margin-right: 50px;
    }

    /* Copy button at the end of the textarea */
    #copy-btn {
        position: absolute;
        right: 65px;
        bottom: 50px;
        padding: 5px;
        border-radius: 5px;
        color: #508bfc;
        cursor: pointer;
    }

    #bg {
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        height: 100vh;
    }

    h3 {
        font-family: 'Roboto';
        font-weight: 300;
        font-size: 27px;
        text-align: center;
        font-weight: bolder;
    }

    #quantum {
        /*Linear Gradient text font color from blue to violet*/
        background: -webkit-linear-gradient(45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;

        background-clip: text;

        font-size: 32px;
        font-weight: bold;
    }

    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }
</style>

<body>
    <section id="bg" class="vh-100">
        <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                    <div class="card shadow-2-strong" style="border-radius: 1rem;">
                        <div class="card-body p-5 text-center">

                            <h3>One time pad using </h3>
                            <h3 id="quantum">QRNG</h3>

                            <hr class="my-4">

                            <div class="form-outline mb-4">
                                <label class="form-label" for="msg">Message</label>
                                <input type="text" id="msg" class="form-control form-control-lg" />
                            </div>

                            <div role="group" class="d-flex align-items-end justify-content-center btn-group">

                                <button id="encrypt" class="btn btn-primary btn-lg" type="button"
                                    onclick="encrypt()">Encrypt</button>

                                <button id="decrypt" class="btn btn-primary btn-lg" type="button"
                                    onclick="decrypt()">Decrypt</button>

                            </div>

                            <hr class="my-4">

                            <div class="form-group">
                                <label for="result">Risultato:</label>
                                <textarea class="form-control rounded-0" id="result" rows="1" readonly></textarea>
                                <div id="copy-btn" onclick="copyToClipboard()">
                                    <i class="fa-solid fa-copy"></i>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</body>

</html>